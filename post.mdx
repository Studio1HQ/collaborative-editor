# Building Real-Time Collaborative Documents with Velt.dev and Auth0 in Next.js

Real-time collaboration has become a staple in modern productivity apps‚Äîfrom Google Docs to Figma. But building those features from scratch? It's a monumental task. Fortunately, tools like [Velt.dev](https://velt.dev) are making it easier than ever to add collaborative capabilities to your React/Next.js applications.

In this tutorial, we'll walk you through the process of building a **real-time collaborative document editor** using:

- **Next.js (App Router)** for the application framework
- **Auth0** for authentication
- **Velt.dev** for collaboration (live cursors, comments, presence)

By the end of this article, you'll have a working editor where **authenticated users** can:

- Edit the same document simultaneously
- Add comments by selecting text
- See **live cursors** of other collaborators
- View **presence indicators** of who's in the document

Let's dive in.

## Why combine Velt.dev with Auth0 in a Next.js app?

Many Next.js applications require user authentication, especially when dealing with sensitive data or collaborative features. Auth0 provides a robust authentication solution that integrates seamlessly with Next.js, allowing you to manage user identities securely.

Velt.dev, on the other hand, specializes in real-time collaboration features like live cursors, comments, and presence. It abstracts away the complexities of real-time data synchronization, allowing developers to focus on building their applications rather than the underlying infrastructure, making it easy to add collaborative features to your app.

Using Velt.dev alongside Auth0 in a Next.js application allows you to:

- Leverage Auth0's secure authentication to manage user identities
- Use Velt.dev's real-time collaboration features without reinventing the wheel
- Provide a seamless user experience where authenticated users can collaborate in real time

## ‚öôÔ∏è Setup

### Prerequisites

Make sure you have:

- A [Velt.dev](https://velt.dev) account (free tier is enough)
- An [Auth0](https://auth0.com) account
- Next.js project with App Router

### 1. Initialize a Next.js App

```bash
npx create-next-app@latest collaborative-editor --app
cd collaborative-editor
npm install
```

### 2. Install Dependencies

We'll use:

- `@auth0/nextjs-auth0` for authentication
- `@veltdev/react` for collaboration
- `react-quill` as a simple rich text editor

```bash
npm install @auth0/nextjs-auth0 @veltdev/react react-quill
```

### 3. Configure Auth0

Auth0 will handle user authentication, allowing users to log in and access the collaborative editor securely. To configure Auth0, do the following:

#### Create an `.env.local` file

Create a `.env.local` file with the following content:

```env
AUTH0_SECRET='LONG_RANDOM_STRING'
APP_BASE_URL='http://localhost:3000'
AUTH0_DOMAIN='https://YOUR_DOMAIN.auth0.com'
AUTH0_CLIENT_ID='YOUR_CLIENT_ID'
AUTH0_CLIENT_SECRET='YOUR_CLIENT_SECRET'
```

#### Create an Auth0 Application

To set up Auth0, you'll need to create an application in your Auth0 dashboard. Log in to your Auth0 dashboard and on the side panel, select **Applications** > **Applications**, then click **Create Application**. Give your application a name, choose **Regular Web Application**, and click **Create**. Then select **Next.js** as the technology.

Next, select **Settings** and copy the following values into your `.env.local`:

- **Domain**
- **Client ID**
- **Client Secret**

Make sure to set the **Allowed Callback URLs** to `http://localhost:3000/auth/callback`, and the **Allowed Logout URLs** to `http://localhost:3000`.

#### Create the Auth0 SDK Client

Create a new file `lib/auth0.ts` to handle authentication, sessions and user data:

```ts
import { Auth0Client } from "@auth0/nextjs-auth0/server";

export const auth0 = new Auth0Client();
```

#### Create the Auth0 Middleware

Create a new file `middleware.ts` to handle authentication middleware:

```ts
import type { NextRequest } from "next/server";
import { auth0 } from "./lib/auth0";

export async function middleware(request: NextRequest) {
  return await auth0.middleware(request);
}

export const config = {
  matcher: [
    "/((?!_next/static|_next/image|favicon.ico|sitemap.xml|robots.txt).*)",
  ],
};
```

#### Add the Sign Up and Login Buttons

Update file `app/page.tsx` to handle the home page with login and signup buttons:

```tsx
import { auth0 } from "@/lib/auth0";
import "./globals.css";

export default async function Home() {
  const session = await auth0.getSession();

  if (!session) {
    return (
      <main className="min-h-screen flex flex-col items-center justify-center bg-gray-50">
        <div className="text-center space-y-8 p-8 max-w-md w-full bg-white rounded-lg shadow-lg">
          <h1 className="text-3xl font-bold text-gray-800">
            Collaborative Editor
          </h1>
          <p className="text-gray-600">
            A real-time collaborative editing platform. Work together with your
            team in real-time.
          </p>
          <div className="space-y-4">
            <a href="/auth/login?screen_hint=signup" className="block">
              <button className="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
                Sign up
              </button>
            </a>
            <a href="/auth/login" className="block">
              <button className="w-full border border-gray-300 hover:border-gray-400 text-gray-700 font-medium py-2 px-4 rounded-md transition-colors">
                Log in
              </button>
            </a>
          </div>
        </div>
      </main>
    );
  }

  return (
    <main className="min-h-screen bg-gray-50">
      <div className="max-w-4xl mx-auto p-8">
        <div className="bg-white rounded-lg shadow-lg p-6">
          <div className="flex justify-between items-center mb-6">
            <h1 className="text-2xl font-bold text-gray-800">
              Welcome, {session.user.name}!
            </h1>
            <a href="/auth/logout">
              <button className="bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-md transition-colors">
                Log out
              </button>
            </a>
          </div>
          <p className="text-gray-600">
            Start collaborating on your documents in real-time.
          </p>
        </div>
      </div>
    </main>
  );
}
```

Running this code will give you a simple home page with options to log in or sign up. Once logged in, users will see a welcome message and a logout button.

### 4. Configure Velt.dev

Create a project in [Velt.dev](https://velt.dev), get your **project ID**, and add it to `.env.local`:

```env
VELT_PROJECT_ID=your-velt-project-id
```

We'll initialize Velt on the client side later using this ID.

## üõ†Ô∏è Implementation

Now let's build the collaborative document page.

### 1. Auth0 Integration with App Router

Wrap your app in the Auth0 provider.

#### `app/layout.tsx`

```tsx
import { UserProvider } from "@auth0/nextjs-auth0/client";

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body>
        <UserProvider>{children}</UserProvider>
      </body>
    </html>
  );
}
```

### 2. Setup the Document Editor Page

Create `app/editor/page.tsx`.

This page:

- Checks if the user is authenticated
- Loads the Velt provider
- Initializes collaboration features

#### `app/editor/page.tsx`

```tsx
"use client";

import { useUser } from "@auth0/nextjs-auth0/client";
import { useEffect } from "react";
import { VeltProvider, VeltPresence, VeltLiveCursors, useVelt } from "velt";
import ReactQuill from "react-quill";
import "react-quill/dist/quill.snow.css";

export default function EditorPage() {
  const { user, error, isLoading } = useUser();

  useEffect(() => {
    if (user) {
      // Pass Auth0 user data to Velt for identity tracking
      window.Velt.setUser({
        userId: user.sub, // unique identifier
        name: user.name,
        avatar: user.picture,
        email: user.email,
      });
    }
  }, [user]);

  if (isLoading) return <p>Loading...</p>;
  if (error) return <p>Error loading user.</p>;
  if (!user) return <a href="/api/auth/login">Login</a>;

  return (
    <VeltProvider apiKey={process.env.NEXT_PUBLIC_VELT_PROJECT_ID!}>
      <div className="p-6 max-w-4xl mx-auto">
        <h1 className="text-2xl font-semibold mb-4">Shared Document</h1>

        <div className="border rounded p-4 relative">
          <ReactQuill theme="snow" />
          <VeltLiveCursors />
          <VeltPresence />
        </div>
      </div>
    </VeltProvider>
  );
}
```

### 3. Adding Comments via Text Selection

Velt makes this straightforward using its commenting component.

#### Add `VeltCommentable` wrapper:

Update your `EditorPage` to wrap the editor with `VeltCommentable`.

```tsx
import { VeltCommentable } from 'velt';

...

<VeltCommentable id="doc-editor">
 <ReactQuill theme="snow" />
</VeltCommentable>
```

This enables users to:

- Select text
- Right-click or click a comment icon
- Add inline comments

You can enhance this later with more sophisticated comment UIs, but this is the fastest way to get started.

### 4. Presence & Cursors

We already added `<VeltLiveCursors />` and `<VeltPresence />`‚ÄîVelt will show live cursors with user avatars, plus indicators when people enter/leave the document.

You can customize cursor color and display name via `Velt.setUser()` in your `useEffect`.

## üß™ Testing

1. Start the app:

```bash
npm run dev
```

2. Open **two separate incognito windows**, log in with different Auth0 accounts.

3. Navigate to `/editor`

You should now see:

- Each other's cursors in real time
- Presence bubbles/avatars
- Ability to comment on text
- Edits updating live

If something's not syncing, double-check:

- Your `VELT_PROJECT_ID`
- That users are successfully passed to `Velt.setUser()`
- The `VeltProvider` wraps your components properly

## üß† Why These Choices?

**Why ReactQuill?**

- Easy to drop in a rich text editor
- Works well with Velt's comment overlays

**Why pass Auth0 data into `Velt.setUser()`?**

- Velt needs to know who each user is to track presence, comments, etc.
- We reuse the existing Auth0 identity to avoid duplicate login systems

**Why Velt for collaboration?**

- Built specifically for real-time apps
- Handles operational transforms, presence, and comments out of the box
- Abstracts away complex CRDT logic

## üõ° Production Considerations

A few quick notes for production-readiness:

- **Authentication gating:** Lock down routes on the server to prevent unauthorized access to documents
- **Data persistence:** Right now, our editor doesn't save to a backend. You'll want to connect changes to a database (e.g., via Velt's content syncing APIs or by capturing changes from the editor)
- **Rate limiting / abuse:** Be sure to throttle comment creation and document edits if your app is public
- **Role-based access:** Add permissions (e.g., read-only vs editor) based on Auth0 user roles

## ‚úÖ Conclusion

{/* You now have a working collaborative document editor */}

With minimal setup, you've now built a fully authenticated, real-time collaborative editor using:

- **Velt.dev** for comments, presence, and cursors
- **Auth0** for authentication
- **Next.js 14+** for modern app structure

This combination is ideal for teams building productivity tools, educational platforms, or any app where real-time collaboration matters.

If you're expanding this, consider:

- Richer document structures (not just plain HTML)
- Comment threads and notifications
- Granular document access controls

Happy building!

## üîó Resources

- [Velt.dev Docs](https://docs.velt.dev)
- [Auth0 Next.js SDK](https://auth0.com/docs/quickstart/webapp/nextjs)
- [React Quill](https://github.com/zenoamaro/react-quill)

Want the full codebase as a starter? Let me know, and I'll drop a GitHub repo or zip export.
